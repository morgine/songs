(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"4db7":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{attrs:{padding:""}},[a("div",{staticClass:"row items-center q-gutter-lg"},[a("q-select",{staticStyle:{"min-width":"120px"},attrs:{options:e.groups,"option-label":"Name","option-value":"ID",label:"选择分组"},model:{value:e.selectedGroup,callback:function(t){e.selectedGroup=t},expression:"selectedGroup"}}),a("q-btn",{attrs:{color:"primary",label:"添加分组"},on:{click:e.appendGroup}}),a("q-select",{staticStyle:{"min-width":"360px"},attrs:{options:e.appOptions,"option-label":"NickName","option-value":"Appid",label:"选择公众号",clearable:"","use-input":"","input-debounce":"0",multiple:""},on:{filter:e.filterFn},model:{value:e.selectedApps,callback:function(t){e.selectedApps=t},expression:"selectedApps"}}),a("q-btn",{attrs:{color:"primary",label:"应用关注回复",loading:e.applying,disable:!((e.articles&&e.articles.length>0||e.cards&&e.cards.length>0)&&e.selectedApps&&e.selectedApps.length>0)},on:{click:e.apply}}),a("q-btn",{attrs:{color:"primary",label:"移除关注回复",disable:!(e.selectedApps&&e.selectedApps.length>0)},on:{click:e.reset}})],1),e.selectedGroup?a("q-card",{staticClass:"q-mt-lg"},[a("q-card-section",[a("div",{staticClass:"row justify-between items-center"},[a("div",{staticClass:"text-h6 cursor-pointer"},[e._v("\n          "+e._s(e.selectedGroup.Name)+"\n          "),a("q-icon",{attrs:{name:"edit"}}),a("q-popup-edit",{attrs:{title:"编辑分组名称",buttons:""},on:{save:function(t){return e.saveGroup(t,e.selectedGroup.ID)}},model:{value:e.selectedGroup.Name,callback:function(t){e.$set(e.selectedGroup,"Name",t)},expression:"selectedGroup.Name"}},[a("q-input",{attrs:{dense:"",autofocus:""},model:{value:e.selectedGroup.Name,callback:function(t){e.$set(e.selectedGroup,"Name",t)},expression:"selectedGroup.Name"}})],1)],1),e.groups.length>1?a("q-btn",{attrs:{flat:"",dense:"",color:"primary",label:"删除分组"},on:{click:function(t){return e.confirmDeleteGroup(e.selectedGroup.ID)}}}):e._e()],1)]),a("q-card-section",[a("q-card",{attrs:{flat:""}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("图文列表")])]),a("q-card-section",e._l(e.articles,(function(t,s){return a("q-card",{key:s,attrs:{flat:""}},[a("q-card-section",[a("a",{attrs:{href:"javascript: void(0)"},on:{click:function(t){return e.openDialog("article-image-selector-"+s)}}},[a("q-img",{staticClass:"q-hoverable",attrs:{src:e.$axios.defaults.baseURL+"/picture/"+t.PicFile,width:0===s&&e.articles.length>1?"300px":"120px",height:"120px"},scopedSlots:e._u([{key:"error",fn:function(){return[a("div",{staticClass:"absolute-full flex flex-center"},[e._v("\n                      选择封面\n                    ")])]},proxy:!0}],null,!0)})],1),a("ImageSelector",{ref:"article-image-selector-"+s,refInFor:!0,model:{value:t.PicFile,callback:function(a){e.$set(t,"PicFile",a)},expression:"article.PicFile"}})],1),a("q-card-section",[a("q-input",{attrs:{label:"标题"},model:{value:t.Title,callback:function(a){e.$set(t,"Title",a)},expression:"article.Title"}})],1),a("q-card-section",[a("q-input",{attrs:{label:"描述"},model:{value:t.Description,callback:function(a){e.$set(t,"Description",a)},expression:"article.Description"}})],1),a("q-card-section",[a("q-input",{attrs:{label:"地址"},model:{value:t.Url,callback:function(a){e.$set(t,"Url",a)},expression:"article.Url"}})],1),a("q-card-actions",{attrs:{align:"around"}},[a("q-btn",{attrs:{icon:"remove",flat:""},on:{click:function(a){return e.delArticle(t.ID)}}}),a("q-btn",{attrs:{icon:"check",flat:""},on:{click:function(a){return e.saveArticle(t)}}})],1)],1)})),1),a("q-card-actions",{attrs:{align:"center"}},[e.articles.length<8?a("q-btn",{attrs:{icon:"add",color:"primary",flat:""},on:{click:function(t){return e.createArticle({GroupID:e.selectedGroup.ID})}}}):e._e()],1)],1),a("q-card",{attrs:{flat:""}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("小程序卡片")])]),a("q-card-section",e._l(e.cards,(function(t,s){return a("q-card",{key:s,attrs:{flat:""}},[a("q-card-section",[a("a",{attrs:{href:"javascript: void(0)"},on:{click:function(t){return e.openDialog("card-image-selector-"+s)}}},[a("q-img",{staticClass:"q-hoverable",attrs:{src:e.$axios.defaults.baseURL+"/picture/"+t.ThumbMediaFilename,width:"100px",height:"120px"},scopedSlots:e._u([{key:"error",fn:function(){return[a("div",{staticClass:"absolute-full flex flex-center"},[e._v("\n                      选择封面\n                    ")])]},proxy:!0}],null,!0)})],1),a("ImageSelector",{ref:"card-image-selector-"+s,refInFor:!0,model:{value:t.ThumbMediaFilename,callback:function(a){e.$set(t,"ThumbMediaFilename",a)},expression:"card.ThumbMediaFilename"}})],1),a("q-card-section",[a("q-input",{attrs:{label:"小程序标题"},model:{value:t.Title,callback:function(a){e.$set(t,"Title",a)},expression:"card.Title"}})],1),a("q-card-section",[a("q-input",{attrs:{label:"小程序 appid",hint:"小程序需要与公众号关联"},model:{value:t.Appid,callback:function(a){e.$set(t,"Appid",a)},expression:"card.Appid"}})],1),a("q-card-section",[a("q-input",{attrs:{label:"小程序地址"},model:{value:t.PagePath,callback:function(a){e.$set(t,"PagePath",a)},expression:"card.PagePath"}})],1),a("q-card-actions",{attrs:{align:"around"}},[a("q-btn",{attrs:{icon:"remove",flat:""},on:{click:function(a){return e.delCard(t.ID)}}}),a("q-btn",{attrs:{icon:"check",flat:""},on:{click:function(a){return e.saveCard(t)}}})],1)],1)})),1),a("q-card-actions",{attrs:{align:"center"}},[e.cards.length<8?a("q-btn",{attrs:{icon:"add",flat:"",color:"primary"},on:{click:function(t){return e.createCard({GroupID:e.selectedGroup.ID})}}}):e._e()],1)],1)],1)],1):e._e()],1)},i=[],r=(a("c975"),a("a434"),a("ed24")),l={name:"Index",components:{ImageSelector:r["a"]},data(){return{groups:[],selectedGroup:null,articles:[],cards:[],applying:!1,apps:[{Appid:"",NickName:""}],appOptions:[],selectedApps:[]}},watch:{selectedGroup(){this.getArticles(),this.getCards()}},created(){this.$axios.get("/subscribe/msg/groups").then((e=>{e=e.data,e&&e.Data&&(this.groups=e.Data)}));const e={Limit:2e3,Offset:0,Column:"id",Desc:!0,Selects:["appid","nick_name"]};this.$axios.get("/apps",{params:e}).then((e=>{e=e.data,e&&e.Data&&(this.apps=e.Data)}))},methods:{openDialog(e){this.$refs[e][0].openDialog()},filterFn(e,t){t(""!==e?()=>{this.appOptions=this.apps.filter((t=>t.NickName.indexOf(e)>-1))}:()=>{this.appOptions=this.apps})},appendGroup(){const e={Name:"新建分组",ID:0};this.$axios.put("/subscribe/msg/group",e).then((e=>{e=e.data,e&&e.Data&&(this.groups.push(e.Data),this.selectedGroup=e.Data)}))},apply(){this.applying=!0,this.$axios.post("/subscribe/msg/group/apply",{Appids:this.selectedApps,GroupID:this.selectedGroup}).then((e=>{e=e.data,e&&e.Message&&this.$q.notify(e.Message),this.applying=!1})).catch((()=>{this.applying=!1}))},reset(){this.$axios.delete("/subscribe/msg/group/cancel",{params:{Appids:this.selectedApps}}).then((e=>{e=e.data,e&&e.Message&&this.$q.notify(e.Message)}))},saveGroup(e,t){const a={Name:e,ID:t};this.$axios.put("/subscribe/msg/group",a).then((e=>{e=e.data,e&&e.Message&&this.$q.notify(e.Message)}))},confirmDeleteGroup(e){this.$q.dialog({title:"确认删除？",message:`菜单组：${e.Name}`,cancel:!0}).onOk((()=>{this.deleteGroup(e)}))},deleteGroup(e){this.$axios.delete("/subscribe/msg/group",{params:{ID:e.ID}}).then((t=>{if(t=t.data,t&&t.Message){this.$q.notify(t.Message);for(let t=0;t<this.groups.length;t++)if(this.groups[t].ID===e.ID){this.groups.splice(t,1);break}}}))},getArticles(){this.selectedGroup&&this.selectedGroup.ID>0&&this.$axios.get("/subscribe/msg/group/articles",{params:{GroupID:this.selectedGroup.ID}}).then((e=>{e=e.data,e&&e.Data&&(this.articles=e.Data)}))},createArticle(e){this.$axios.put("/subscribe/msg/group/article",e).then((e=>{e=e.data,e&&e.Data&&this.articles.push(e.Data)}))},saveArticle(e){this.$axios.put("/subscribe/msg/group/article",e).then((e=>{e=e.data,e&&e.Message&&this.$q.notify(e.Message)}))},delArticle(e){this.$axios.delete("/subscribe/msg/group/article",{params:{ID:e}}).then((t=>{if(t=t.data,t&&t.Message){this.$q.notify(t.Message);for(let t=0;t<this.articles.length;t++)if(this.articles[t].ID===e){this.articles.splice(t,1);break}}}))},getCards(){this.selectedGroup&&this.selectedGroup.ID>0&&this.$axios.get("/subscribe/msg/group/mini-program-cards",{params:{GroupID:this.selectedGroup.ID}}).then((e=>{e=e.data,e&&e.Data&&(this.cards=e.Data)}))},createCard(e){this.$axios.put("/subscribe/msg/group/mini-program-card",e).then((e=>{e=e.data,e&&e.Data&&this.cards.push(e.Data)}))},saveCard(e){this.$axios.put("/subscribe/msg/group/mini-program-card",e).then((e=>{e=e.data,e&&e.Message&&this.$q.notify(e.Message)}))},delCard(e){this.$axios.delete("/subscribe/msg/group/mini-program-card",{params:{ID:e}}).then((t=>{if(t=t.data,t&&t.Message){this.$q.notify(t.Message);for(let t=0;t<this.cards.length;t++)if(this.cards[t].ID===e){this.cards.splice(t,1);break}}}))}}},c=l,n=a("2877"),o=a("9989"),p=a("ddd8"),u=a("9c40"),d=a("f09f"),g=a("a370"),h=a("0016"),m=a("42a1"),f=a("27f9"),b=a("068f"),q=a("4b7e"),D=a("eebe"),x=a.n(D),v=Object(n["a"])(c,s,i,!1,null,null,null);t["default"]=v.exports;x()(v,"components",{QPage:o["a"],QSelect:p["a"],QBtn:u["a"],QCard:d["a"],QCardSection:g["a"],QIcon:h["a"],QPopupEdit:m["a"],QInput:f["a"],QImg:b["a"],QCardActions:q["a"]})},ed24:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("q-card",[a("q-card-section",[a("q-form",{on:{submit:e.uploadImage}},[a("q-file",{attrs:{name:"picture",filled:"",multiple:"","use-chips":"",label:"选择上传文件",accept:".jpg, .png, image/*"},model:{value:e.files,callback:function(t){e.files=t},expression:"files"}}),a("div",{staticClass:"q-mt-lg"},[a("q-btn",{attrs:{label:"提交上传",type:"submit",color:"primary",disable:!e.files}})],1)],1)],1),a("q-card-section",{staticClass:"scroll",staticStyle:{"max-height":"60vh"}},[a("div",{staticClass:"q-pa-md row items-start q-gutter-md"},e._l(e.images,(function(t,s){return a("q-card",{key:t.ID},[a("q-img",{staticClass:"col",attrs:{src:e.$axios.defaults.baseURL+"/picture/"+t.File},scopedSlots:e._u([{key:"error",fn:function(){return[a("div",{staticClass:"absolute-full flex flex-center"},[e._v("\n                error!\n              ")])]},proxy:!0}],null,!0)}),a("q-card-actions",{attrs:{align:"around"}},[a("q-btn",{attrs:{flat:"",icon:"delete"},on:{click:function(a){return e.delImage(t.ID,s)}}}),a("q-btn",{attrs:{flat:"",icon:"check"},on:{click:function(a){e.selected=t.File}}})],1)],1)})),1)]),e.pagination.Total?a("q-card-section",[a("q-pagination",{attrs:{max:e.maxPage,input:!0},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}})],1):e._e(),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"取消",color:"primary"}})],1)],1)],1)},i=[],r=(a("a434"),a("ddb0"),{props:["value"],data(){return{images:[],dialog:!1,files:null,selected:null,image:{ID:0,File:"",Url:""},pagination:{Limit:10,Offset:0,Total:0},current:1}},computed:{maxPage(){return Math.ceil(this.pagination.Total/this.pagination.Limit)}},created(){console.log(this.$axios.defaults),this.count()},watch:{current(e){this.pagination.Offset=this.Limit*e,this.getImages()},selected(e){this.$emit("input",e),this.dialog=!1}},methods:{count(){this.$axios.get("/big-picture/count").then((e=>{e=e.data,e&&e.Data&&(this.pagination.Total=e.Data,this.getImages())}))},uploadImage(e){const t=new FormData(e.target);this.loading=!0,this.$axios.put("/big-pictures",t).then((e=>{if(e=e.data,e&&e.Data){for(const t of e.Data)this.images.splice(0,0,t);this.pagination.Total+=e.Data.length}}))},delImage(e,t){this.$axios.delete("/big-pictures",{params:{IDs:[e]}}).then((e=>{e=e.data,(e&&e.Data||0===e.Data)&&(this.pagination.Total=e.Data),this.images.splice(t,1)}))},getImages(){this.$axios.get("/big-pictures",{params:this.pagination}).then((e=>{e=e.data,e&&e.Data&&this.images.splice(0,this.images.length,...e.Data)}))},openDialog(){this.dialog=!0}}}),l=r,c=a("2877"),n=a("24e8"),o=a("f09f"),p=a("a370"),u=a("0378"),d=a("7d53"),g=a("9c40"),h=a("068f"),m=a("4b7e"),f=a("3b16"),b=a("7f67"),q=a("eebe"),D=a.n(q),x=Object(c["a"])(l,s,i,!1,null,"4b79ac0f",null);t["a"]=x.exports;D()(x,"components",{QDialog:n["a"],QCard:o["a"],QCardSection:p["a"],QForm:u["a"],QFile:d["a"],QBtn:g["a"],QImg:h["a"],QCardActions:m["a"],QPagination:f["a"]}),D()(x,"directives",{ClosePopup:b["a"]})}}]);