(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"58c1":function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("q-page",{staticClass:"column q-gutter-lg",attrs:{padding:""}},[t("div",{staticClass:"row items-center q-mb-lg"},[t("q-form",{staticClass:"row q-gutter-lg"},[t("q-input",{attrs:{type:"textarea",filled:"",label:"指定的公众号APPID",hint:"不填则统计所有公众号，多个公众号以换行分割"},model:{value:e.params.Appids,callback:function(a){e.$set(e.params,"Appids",a)},expression:"params.Appids"}}),t("q-input",{attrs:{filled:"",label:"开始日期"},scopedSlots:e._u([{key:"append",fn:function(){return[t("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[t("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t("q-date",{attrs:{mask:"YYYY-MM-DD"},model:{value:e.params.BeginDate,callback:function(a){e.$set(e.params,"BeginDate",a)},expression:"params.BeginDate"}},[t("div",{staticClass:"row items-center justify-end"},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.params.BeginDate,callback:function(a){e.$set(e.params,"BeginDate",a)},expression:"params.BeginDate"}}),t("q-input",{attrs:{filled:"",label:"结束日期"},scopedSlots:e._u([{key:"append",fn:function(){return[t("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[t("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t("q-date",{attrs:{mask:"YYYY-MM-DD"},model:{value:e.params.EndDate,callback:function(a){e.$set(e.params,"EndDate",a)},expression:"params.EndDate"}},[t("div",{staticClass:"row items-center justify-end"},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.params.EndDate,callback:function(a){e.$set(e.params,"EndDate",a)},expression:"params.EndDate"}}),t("q-space"),t("div",{staticClass:"row items-center"},[t("q-btn",{attrs:{label:"获取统计",type:"submit",color:"primary"},on:{click:e.getSummary}})],1)],1)],1),t("q-table",{attrs:{title:"统计总量",data:e.summaries.Total?e.summaries.Total:[],columns:e.totalColumns,"row-key":"RefDate",loading:e.loading},scopedSlots:e._u([{key:"top-right",fn:function(){return[t("q-btn",{attrs:{color:"primary","icon-right":"archive",label:"导出 csv","no-caps":""},on:{click:function(a){return e.exportTable("总量-"+e.params.BeginDate+"-"+e.params.EndDate,e.summaries.Total,e.totalColumns)}}})]},proxy:!0}])}),e._l(e.summaries.AppSummaries,(function(a){return t("q-table",{key:a.Appid,attrs:{title:a.Nickname,data:a.Summaries?a.Summaries:[],columns:e.totalColumns,"row-key":"ref_date"},scopedSlots:e._u([{key:"top-right",fn:function(){return[a.Err?t("span",{staticClass:"text-grey text-subtitle1 q-mr-lg"},[e._v("\n        "+e._s(a.Err)+"\n      ")]):e._e(),t("q-btn",{attrs:{color:"primary","icon-right":"archive",label:"导出 csv","no-caps":""},on:{click:function(t){return e.exportTable(a.Nickname+"-"+e.model.from+"-"+e.model.to,a.Summaries,e.totalColumns)}}})]},proxy:!0}],null,!0)})}))],2)},r=[],n=(t("498a"),t("bd4c")),i=t("a357");const o=Date.now(),l=864e5,p=n["b"].formatDate(o-l,"YYYY-MM-DD"),c=n["b"].formatDate(o-2*l,"YYYY-MM-DD");function m(e,a){let t=void 0!==a?a(e):e;return t=void 0===t||null===t?"":String(t),t=t.split('"').join('""'),`"${t}"`}var u={name:"UserSummary",data(){return{params:{Appids:"",BeginDate:c,EndDate:p},loading:!1,expanded:!1,totalColumns:[{name:"ref_date",align:"right",label:"日期",field:"ref_date"},{name:"user_source",align:"right",label:"来源",field:"user_source",format:e=>this.userSources[e]},{name:"new_user",align:"right",label:"新增用户",field:"new_user"},{name:"cancel_user",align:"right",label:"取关用户",field:"cancel_user"},{name:"positive_user",align:"right",label:"净增用户",field:e=>e.new_user-e.cancel_user}],summaries:{Total:[],AppSummaries:[]},userSources:{0:"其他合计",1:"公众号搜索",17:"名片分享",30:"扫描二维码",51:"支付后关注",57:"文章内账号名称",100:"微信广告",161:"他人转载",176:"专辑页内账号名称"},Summary:{ref_date:"",user_source:0,new_user:0,cancel_user:0,cumulate_user:0},AppSummary:{Appid:"",Nickname:"",Err:"",Summaries:[]}}},methods:{getSummary(){this.loading=!0;const e={BeginDate:this.params.BeginDate,EndDate:this.params.EndDate};if(e.BeginDate>e.EndDate){const a=e.EndDate;e.EndDate=e.BeginDate,e.BeginDate=a}if(this.params.Appids){e.Appids=[];const a=this.params.Appids.split("\n");for(let t=0;t<a.length;t++){const s=a[t].trim();s&&e.Appids.push(s)}}this.$axios.get("/user-summary",{params:e}).then((e=>{e=e.data,e&&e.Data?this.summaries=e.Data:e.Message&&this.$q.notify(e.Message),this.loading=!1}))},exportTable(e,a,t){const s=[t.map((e=>m(e.label)))].concat(a.map((e=>t.map((a=>m("function"===typeof a.field?a.field(e):e[void 0===a.field?a.name:a.field],a.format))).join(",")))).join("\r\n"),r=Object(i["a"])(`${e}.csv`,s,"text/csv");!0!==r&&this.$q.notify({message:"浏览器阻止下载文件...",color:"negative",icon:"warning"})}}},d=u,f=t("2877"),g=t("9989"),b=t("0378"),D=t("27f9"),h=t("0016"),y=t("7cbe"),v=t("52ee"),_=t("9c40"),q=t("2c91"),w=t("eaac"),k=t("7f67"),x=t("eebe"),S=t.n(x),C=Object(f["a"])(d,s,r,!1,null,"2c060e18",null);a["default"]=C.exports;S()(C,"components",{QPage:g["a"],QForm:b["a"],QInput:D["a"],QIcon:h["a"],QPopupProxy:y["a"],QDate:v["a"],QBtn:_["a"],QSpace:q["a"],QTable:w["a"]}),S()(C,"directives",{ClosePopup:k["a"]})}}]);