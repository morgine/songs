(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{b85c:function(a,t,e){"use strict";e.r(t);var i=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("q-page",{attrs:{padding:""}},[e("q-form",{staticClass:"column q-gutter-lg"},[e("q-input",{attrs:{label:"小程序标题"},model:{value:a.card.Title,callback:function(t){a.$set(a.card,"Title",t)},expression:"card.Title"}}),e("q-input",{attrs:{label:"小程序地址"},model:{value:a.card.PagePath,callback:function(t){a.$set(a.card,"PagePath",t)},expression:"card.PagePath"}}),e("div",[e("a",{attrs:{href:"javascript: void(0)"},on:{click:function(t){return a.$refs["image-selector"].openDialog()}}},[e("q-img",{attrs:{src:a.card.ThumbMediaFilename?"/v1/picture/"+a.card.ThumbMediaFilename:"",width:"100px",height:"120px"},scopedSlots:a._u([{key:"error",fn:function(){return[e("div",{staticClass:"absolute-full flex flex-center"},[a._v("\n              选择封面\n            ")])]},proxy:!0}])},[e("div",{staticClass:"absolute-full text-subtitle1 flex flex-center"},[a._v("\n            选择封面\n          ")])])],1)]),e("div",{staticClass:"row"},[e("q-btn",{attrs:{label:"删除"},on:{click:a.delCard}}),e("q-btn",{staticClass:"q-ml-md",attrs:{label:"保存",color:"primary"},on:{click:a.saveCard}})],1)],1),e("ImageSelector",{ref:"image-selector",model:{value:a.card.ThumbMediaFilename,callback:function(t){a.$set(a.card,"ThumbMediaFilename",t)},expression:"card.ThumbMediaFilename"}})],1)},s=[],l=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:a.dialog,callback:function(t){a.dialog=t},expression:"dialog"}},[e("q-card",{staticStyle:{width:"100%"}},[e("q-card-section",[e("q-form",{on:{submit:a.uploadImage}},[e("q-file",{attrs:{name:"picture",filled:"",multiple:"","use-chips":"",label:"选择上传文件",accept:".jpg, .png, image/*"},model:{value:a.files,callback:function(t){a.files=t},expression:"files"}}),e("div",{staticClass:"q-mt-lg"},[e("q-btn",{attrs:{label:"提交上传",type:"submit",color:"primary",disable:!a.files}})],1)],1)],1),e("q-card-section",[e("div",{staticClass:"row q-gutter-lg"},a._l(a.images,(function(t,i){return e("div",{key:t.ID,staticClass:"column col-sm-12 col-md-6 col-lg-4 col-xl-3"},[e("q-img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:"/v1/picture/"+t.File},scopedSlots:a._u([{key:"error",fn:function(){return[e("div",{staticClass:"absolute-full flex flex-center"},[a._v("\n                error!\n              ")])]},proxy:!0}],null,!0)}),e("div",{staticClass:"flex justify-around"},[e("q-btn",{attrs:{icon:"delete"},on:{click:function(e){return a.delImage(t.ID,i)}}}),e("q-btn",{attrs:{icon:"check"},on:{click:function(e){a.selected=t.File}}})],1)],1)})),0)]),a.pagination.Total?e("q-card-section",[e("q-pagination",{attrs:{max:a.maxPage,input:!0},model:{value:a.current,callback:function(t){a.current=t},expression:"current"}})],1):a._e(),e("q-card-actions",{attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"取消",color:"primary"}})],1)],1)],1)},n=[],r=(e("a434"),e("ddb0"),{props:["value"],data(){return{images:[],dialog:!1,files:null,selected:null,image:{ID:0,File:"",Url:""},pagination:{Limit:10,Offset:0,Total:0},current:1}},computed:{maxPage(){return Math.ceil(this.pagination.Total/this.pagination.limit)}},created(){this.count()},watch:{current(a){this.pagination.Offset=this.Limit*a,this.getImages()},selected(a){this.$emit("input",a),this.dialog=!1}},methods:{count(){this.$axios.get("/big-picture/count").then((a=>{a=a.data,a&&a.Data&&(this.pagination.Total=a.Data,this.getImages())}))},uploadImage(a){const t=new FormData(a.target);this.loading=!0,this.$axios.put("/big-pictures",t).then((a=>{if(a=a.data,a&&a.Data){for(const t of a.Data)this.images.splice(0,0,t);this.pagination.Total+=a.Data.length}}))},delImage(a,t){this.$axios.delete("/big-pictures",{params:{IDs:[a]}}).then((a=>{a=a.data,(a&&a.Data||0===a.Data)&&(this.pagination.Total=a.Data),this.images.splice(t,1)}))},getImages(){this.$axios.get("/big-pictures",{params:this.pagination}).then((a=>{a=a.data,a&&a.Data&&this.images.splice(0,this.images.length,...a.Data)}))},openDialog(){this.dialog=!0}}}),c=r,o=e("2877"),d=e("24e8"),u=e("f09f"),g=e("a370"),m=e("0378"),p=e("7d53"),h=e("9c40"),f=e("068f"),b=e("3b16"),v=e("4b7e"),x=e("7f67"),q=e("eebe"),C=e.n(q),D=Object(o["a"])(c,l,n,!1,null,"49b17b8d",null),T=D.exports;C()(D,"components",{QDialog:d["a"],QCard:u["a"],QCardSection:g["a"],QForm:m["a"],QFile:p["a"],QBtn:h["a"],QImg:f["a"],QPagination:b["a"],QCardActions:v["a"]}),C()(D,"directives",{ClosePopup:x["a"]});var k={name:"Index",components:{ImageSelector:T},data(){return{card:{Title:"",PagePath:"",ThumbMediaFilename:""},dialog:!1}},created(){this.getCard()},methods:{getCard(){this.$axios.get("/mini-program-card").then((a=>{a=a.data,a&&a.Data&&(this.card=a.Data)}))},saveCard(){this.$axios.put("/mini-program-card",this.card).then((a=>{a=a.data,a&&a.Message&&this.$q.notify(a.Message)}))},delCard(){this.$axios.delete("/mini-program-card").then((a=>{a=a.data,a&&a.Message&&(this.$q.notify(a.Message),this.card={Title:"",PagePath:"",ThumbMediaFilename:""})}))}}},I=k,$=e("9989"),w=e("27f9"),P=Object(o["a"])(I,i,s,!1,null,"75befc48",null);t["default"]=P.exports;C()(P,"components",{QPage:$["a"],QForm:m["a"],QInput:w["a"],QImg:f["a"],QBtn:h["a"]})}}]);