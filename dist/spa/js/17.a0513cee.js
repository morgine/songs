(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"2a45":function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{attrs:{padding:""}},[e("div",{staticClass:"row q-gutter-lg items-center"},[e("q-input",{attrs:{filled:""},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[e("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-date",{attrs:{mask:"YYYY-MM-DD"},model:{value:t.date,callback:function(a){t.date=a},expression:"date"}},[e("div",{staticClass:"row items-center justify-end"},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.date,callback:function(a){t.date=a},expression:"date"}}),e("q-btn",{attrs:{label:"获取",loading:t.loading},on:{click:t.getEvents}})],1),e("q-table",{staticClass:"q-mt-xl",attrs:{title:"总和",data:t.sums,columns:t.sumsColumns,align:"center",loading:t.loading},scopedSlots:t._u([{key:"bottom",fn:function(){},proxy:!0}])}),e("q-table",{staticClass:"q-mt-xl",attrs:{title:"详细数据",data:t.evtApps,columns:t.columns,loading:t.loading,"row-key":"Appid"},scopedSlots:t._u([{key:"body-cell-Manager",fn:function(a){return[e("q-td",{staticClass:"text-right"},[t._v("\n        "+t._s(a.row.Manager?a.row.Manager:"点击设置")+"\n        "),e("q-popup-edit",{attrs:{title:"设置管理员",buttons:""},on:{save:function(e){return t.saveAppManager(e,a.row.Appid)}},model:{value:a.row.Manager,callback:function(e){t.$set(a.row,"Manager",e)},expression:"props.row.Manager"}},[e("q-input",{attrs:{dense:"",autofocus:""},model:{value:a.row.Manager,callback:function(e){t.$set(a.row,"Manager",e)},expression:"props.row.Manager"}})],1)],1)]}}])})],1)},s=[],o=(e("ddb0"),e("bd4c"));const l=Date.now();var r={name:"Event",data(){return{events:[],start:l,apps:[],sums:[],sumsColumns:[{name:"AppNum",label:"已发送公众号数量",field:"AppNum",align:"center"},{name:"TotalCount",label:"标签下的粉丝数",field:"TotalCount",align:"center"},{name:"FilterCount",label:"发送消息的粉丝数",field:"FilterCount",align:"center"},{name:"SentCount",label:"发送成功粉丝数",field:"SentCount",align:"center"}],evtApps:[],columns:[{name:"NickName",label:"公众号",field:"NickName"},{name:"Manager",label:"管理员",field:"Manager",sortable:!0},{name:"Status",label:"状态",field:"Status",sortable:!0},{name:"TotalCount",label:"标签下的粉丝数",field:"TotalCount",sortable:!0},{name:"FilterCount",label:"发送消息的粉丝数",field:"FilterCount",sortable:!0},{name:"SentCount",label:"发送成功粉丝数",field:"SentCount",sortable:!0}],loading:!1}},computed:{date:{get(){return o["b"].formatDate(this.start,"YYYY-MM-DD")},set(t){this.start=o["b"].extractDate(t,"YYYY-MM-DD")}}},created(){const t={Limit:2e3,Offset:0,Column:"id",Desc:!0,Selects:["appid","nick_name"]};this.$axios.get("/apps",{params:t}).then((t=>{if(t=t.data,t&&t.Data){const a=t.Data;this.$axios.get("/apps-manager").then((t=>{if(t=t.data,t&&t.Data){const e=t.Data;for(const t of e)for(const e of a)if(t.Appid===e.Appid){e.Manager=t.Manager;break}}this.apps=a}))}}))},methods:{getEvents(){this.loading=!0,this.evtApps=[],this.sums=[];const t=Math.ceil(o["b"].startOfDate(this.start,"day")/1e3);this.$axios.get("/app-group-msg-result",{params:{Start:t,End:t+86400}}).then((t=>{if(t=t.data,t&&t.Data){const a=[],e={AppNum:0,TotalCount:0,FilterCount:0,SentCount:0};for(const n of this.apps){const s={Appid:n.Appid,NickName:n.NickName,Manager:n.Manager,Status:"",TotalCount:0,FilterCount:0,SentCount:0,ErrorCount:0};for(const a of t.Data)if(a.Appid===n.Appid){s.Status="send success"===a.Status?"成功":a.Status,s.TotalCount=a.TotalCount,s.FilterCount=a.FilterCount,s.SentCount=a.SentCount,s.ErrorCount=a.ErrorCount,e.AppNum++,e.TotalCount+=a.TotalCount,e.FilterCount+=a.FilterCount,e.SentCount+=a.SentCount;break}a.push(s)}this.evtApps=a,this.sums.push(e)}this.loading=!1}))},saveAppManager(t,a){this.$axios.post("/app-manager",{Appid:a,Manager:t}).then((t=>{t=t.data,t&&t.Message&&this.$q.notify(t.Message)}))}}},i=r,p=e("2877"),u=e("9989"),c=e("27f9"),d=e("0016"),m=e("7cbe"),f=e("52ee"),g=e("9c40"),C=e("eaac"),b=e("db86"),h=e("42a1"),M=e("7f67"),v=e("eebe"),w=e.n(v),S=Object(p["a"])(i,n,s,!1,null,"4f4d4d2c",null);a["default"]=S.exports;w()(S,"components",{QPage:u["a"],QInput:c["a"],QIcon:d["a"],QPopupProxy:m["a"],QDate:f["a"],QBtn:g["a"],QTable:C["a"],QTd:b["a"],QPopupEdit:h["a"]}),w()(S,"directives",{ClosePopup:M["a"]})}}]);