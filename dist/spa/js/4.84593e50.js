(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"02f3":function(t,e,n){},1146:function(t,e,n){"use strict";n("02f3")},d24f:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{attrs:{padding:""}},[n("div",{staticClass:"row items-center q-gutter-lg"},[n("q-select",{staticStyle:{"min-width":"120px"},attrs:{options:t.menus,"option-label":"name","option-value":"index",label:"选择菜单组"},model:{value:t.activeMenu,callback:function(e){t.activeMenu=e},expression:"activeMenu"}}),n("q-btn",{attrs:{color:"primary",label:"添加菜单组"},on:{click:t.appendMenu}}),n("q-select",{staticStyle:{"min-width":"360px"},attrs:{options:t.appOptions,"option-label":"NickName","option-value":"Appid",label:"选择公众号",clearable:"","use-input":"","input-debounce":"0",multiple:""},on:{filter:t.filterFn},model:{value:t.selectedApps,callback:function(e){t.selectedApps=e},expression:"selectedApps"}}),n("q-btn",{attrs:{color:"primary",label:"生成公众号菜单",disable:!(t.activeMenu&&t.activeMenu.buttons.length>0&&t.selectedApps&&t.selectedApps.length>0)},on:{click:t.genAppMenu}}),n("q-btn",{attrs:{color:"primary",label:"删除公众号菜单",disable:!(t.selectedApps&&t.selectedApps.length>0)},on:{click:t.delAppMenu}})],1),t.activeMenu?n("q-card",{staticClass:"q-mt-lg"},[n("q-card-section",[n("div",{staticClass:"row justify-between items-center"},[n("div",{staticClass:"text-h6 cursor-pointer"},[t._v("\n          "+t._s(t.activeMenu.name)+"\n          "),n("q-icon",{attrs:{name:"edit"}}),n("q-popup-edit",{scopedSlots:t._u([{key:"default",fn:function(e){var a=e.set,i=e.cancel;return[n("q-input",{attrs:{autofocus:"",dense:""},scopedSlots:t._u([{key:"after",fn:function(){return[n("q-btn",{attrs:{flat:"",dense:"",color:"negative",icon:"cancel"},on:{click:function(t){return t.stopPropagation(),i(t)}}}),n("q-btn",{attrs:{flat:"",dense:"",color:"positive",icon:"check_circle"},on:{click:function(t){return t.stopPropagation(),a(t)}}})]},proxy:!0}],null,!0),model:{value:t.activeMenu.name,callback:function(e){t.$set(t.activeMenu,"name",e)},expression:"activeMenu.name"}})]}}],null,!1,3605709107),model:{value:t.activeMenu.name,callback:function(e){t.$set(t.activeMenu,"name",e)},expression:"activeMenu.name"}})],1),t.menus.length>1?n("q-btn",{attrs:{flat:"",dense:"",color:"primary",label:"删除菜单组"},on:{click:function(e){return t.confirmDeleteMenu(t.activeMenu)}}}):t._e()],1)]),n("q-card-section",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-4"},[n("div",{staticClass:"mobile_menu_preview"},[n("div",{staticClass:"menu-btn-group"},[n("q-btn-group",{attrs:{outline:"",spread:""}},[t._l(t.activeMenu.buttons,(function(e,a){return n("q-btn",{key:a,attrs:{outline:"",label:e.name,color:t.activeMainBtnIndex===a&&""===t.activeSubBtnIndex?"teal":""},on:{click:function(n){return t.clickMainBtn(e,a)}}},[n("q-menu",{ref:"menus",refInFor:!0,attrs:{persistent:"",value:t.activeMainBtnIndex===a,"no-parent-event":"",fit:"",anchor:"top left",self:"bottom left"}},[t._l(e.sub_button,(function(e,i){return n("q-item",{key:a+"-"+i,attrs:{clickable:""},on:{click:function(n){return t.clickSubBtn(e,i)}}},[n("q-item-section",[n("q-item-label",{class:t.activeSubBtnIndex===i?"text-teal":""},[t._v("\n                          "+t._s(e.name)+"\n                        ")])],1)],1)})),!e.sub_button||e.sub_button.length<5?n("q-item",{attrs:{clickable:""},on:{click:function(n){return n.stopPropagation(),t.appendSubButton(e)}}},[n("q-item-section",{staticClass:"text-center"},[n("q-icon",{staticClass:"full-width",attrs:{name:"add"}})],1)],1):t._e()],2)],1)})),n("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.activeMenu&&t.activeMenu.buttons&&t.activeMenu.buttons.length<3,expression:"activeMenu && activeMenu.buttons &&  activeMenu.buttons.length <3"}],attrs:{icon:"add",outline:""},on:{click:function(e){return e.stopPropagation(),t.appendMainButton()}}})],2)],1)])]),n("div",{staticClass:"col-8"},[t.activeBtn?n("q-card",[n("q-card-section",[n("div",{staticClass:"row justify-between items-center"},[n("q-input",{attrs:{label:""!==t.activeSubBtnIndex?"子菜单名称":"菜单名称",dense:""},model:{value:t.activeBtn.name,callback:function(e){t.$set(t.activeBtn,"name",e)},expression:"activeBtn.name"}}),n("q-btn",{attrs:{flat:"",dense:"",color:"primary",label:""!==t.activeSubBtnIndex?"删除子菜单":"删除菜单"},on:{click:function(e){return t.confirmDeleteBtn(t.activeMainBtnIndex,t.activeSubBtnIndex)}}})],1)]),n("q-separator",{attrs:{spaced:""}}),t.activeBtn.sub_button&&0!==t.activeBtn.sub_button.length?n("q-card-section",[n("div",{staticClass:"text-subtitle2 text-grey-7"},[t._v("已添加子菜单，仅可设置菜单名称。")])]):n("q-card-section",[n("q-option-group",{attrs:{inline:"",options:t.types},model:{value:t.activeBtn.type,callback:function(e){t.$set(t.activeBtn,"type",e)},expression:"activeBtn.type"}}),n("q-tab-panels",{staticClass:"rounded-borders",attrs:{animated:""},model:{value:t.activeBtn.type,callback:function(e){t.$set(t.activeBtn,"type",e)},expression:"activeBtn.type"}},[n("q-tab-panel",{attrs:{name:"view"}},[n("q-input",{attrs:{label:"页面地址"},model:{value:t.activeBtn.url,callback:function(e){t.$set(t.activeBtn,"url",e)},expression:"activeBtn.url"}})],1),n("q-tab-panel",{attrs:{name:"media_id"}},[n("q-input",{attrs:{label:"媒体 ID"},model:{value:t.activeBtn.media_id,callback:function(e){t.$set(t.activeBtn,"media_id",e)},expression:"activeBtn.media_id"}})],1),n("q-tab-panel",{attrs:{name:"click"}},[n("q-input",{attrs:{label:"触发 key"},model:{value:t.activeBtn.key,callback:function(e){t.$set(t.activeBtn,"key",e)},expression:"activeBtn.key"}})],1),n("q-tab-panel",{attrs:{name:"miniprogram"}},[n("q-form",[n("q-input",{attrs:{label:"小程序 APPID"},model:{value:t.activeBtn.appid,callback:function(e){t.$set(t.activeBtn,"appid",e)},expression:"activeBtn.appid"}}),n("q-input",{attrs:{label:"小程序地址"},model:{value:t.activeBtn.pagepath,callback:function(e){t.$set(t.activeBtn,"pagepath",e)},expression:"activeBtn.pagepath"}}),n("q-input",{attrs:{label:"备用网页",hint:"旧版微信客户端无法支持小程序，用户点击菜单时将会打开备用网页。"},model:{value:t.activeBtn.url,callback:function(e){t.$set(t.activeBtn,"url",e)},expression:"activeBtn.url"}})],1)],1)],1)],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{color:"primary"},on:{click:function(e){return t.save()}}},[t._v("保 存")])],1)],1):t._e()],1)])])],1):t._e()],1)},i=[],s=(n("c975"),n("a434"),n("ddb0"),{name:"Index",data(){return{menus:[{name:"",index:0,buttons:[{name:"",type:"",sub_button:[],url:"",key:"",appid:"",pagepath:"",media_id:""}]}],activeMenu:null,activeBtnIndex:"",activeMainBtnIndex:"",activeSubBtnIndex:"",activeBtn:null,types:[{label:"网页类型",value:"view"},{label:"媒体类型",value:"media_id"},{label:"事件类型",value:"click"},{label:"小程序类型",value:"miniprogram"}],apps:[{Appid:"",NickName:""}],appOptions:[],selectedApps:[]}},watch:{activeMenu(t,e){t&&e&&t.index===e.index||(this.activeMainBtnIndex="",this.activeSubBtnIndex="",this.activeBtn=null)}},created(){this.$axios.get("/menus").then((t=>{if(t=t.data,t&&t.Data){const e=t.Data;for(let t=0;t<e.length;t++){e[t].index=t,e[t].buttons||(e[t].buttons=[]);for(let n=0;n<e[t].buttons.length;n++)e[t].buttons[n].sub_button||(e[t].buttons[n].sub_button=[])}this.menus=e}}));const t={Limit:2e3,Offset:0,Column:"id",Desc:!0,Selects:["appid","nick_name"]};this.$axios.get("/apps",{params:t}).then((t=>{t=t.data,t&&t.Data&&(this.apps=t.Data)}))},methods:{filterFn(t,e){e(""!==t?()=>{this.appOptions=this.apps.filter((e=>e.NickName.indexOf(t)>-1))}:()=>{this.appOptions=this.apps})},appendMenu(){const t={name:"新建菜单组",index:this.menus.length,buttons:[]};t.name+=t.index,this.menus.push(t),this.activeMenu=t},confirmDeleteMenu(t){this.$q.dialog({title:"确认删除？",message:`菜单组：${t.name}`,cancel:!0}).onOk((()=>{this.deleteMenu(t)}))},deleteMenu(t){for(let e=0;e<this.menus.length;e++){const n=this.menus[e];if(n.index===t.index){this.menus.splice(e,1);const t=e-1>=1?e-1:0;return void(this.activeMenu=this.menus[t])}}},appendMainButton(){const t={name:"菜单名称",sub_button:[]};this.activeMenu.buttons||(this.activeMenu.buttons=[]),this.activeMenu.buttons.push(t)},appendSubButton(t){const e={name:"菜单名称",type:"view"};t.sub_button||(t.sub_button=[]),t.sub_button.push(e),this.$nextTick((()=>{this.$refs.menus.forEach((t=>{t.updatePosition()}))}))},confirmDeleteBtn(){this.$q.dialog({title:"确认删除？",message:`菜单：${this.activeBtn.name}`,cancel:!0}).onOk((()=>{this.deleteBtn()}))},deleteBtn(){if(""!==this.activeSubBtnIndex&&this.activeSubBtnIndex>=0&&this.activeMainBtnIndex>=0){const t=this.activeMenu.buttons[this.activeMainBtnIndex];t.sub_button.splice(this.activeSubBtnIndex,1),t.sub_button.length>1?(this.activeSubBtnIndex=t.sub_button.length-1,this.activeBtn=t.buttons[this.activeSubBtnIndex]):(this.activeSubBtnIndex="",this.activeBtn=null),this.$nextTick((()=>{this.$refs.menus.forEach((t=>{t.updatePosition()}))}))}else this.activeMainBtnIndex>=0&&(this.activeMenu.buttons.splice(this.activeMainBtnIndex,1),this.activeMenu.buttons.length>=1?(this.activeMainBtnIndex=this.activeMenu.buttons.length-1,this.activeBtn=this.activeMenu.buttons[this.activeMainBtnIndex]):(this.activeMainBtnIndex="",this.activeBtn=null))},clickMainBtn(t,e){this.activeMainBtnIndex=e,this.activeSubBtnIndex="",this.activeBtn=t},clickSubBtn(t,e){this.activeSubBtnIndex=e,this.activeBtn=t},save(){this.$axios.put("/menus",this.menus).then((t=>{t=t.data,t&&t.Message&&this.$q.notify(t.Message)}))},genAppMenu(){this.$q.dialog({title:"确认生成菜单？",cancel:!0}).onOk((()=>{const t={Appids:[],Buttons:[]};for(const e of this.selectedApps)t.Appids.push(e.Appid);for(const e of this.activeMenu.buttons)t.Buttons.push(e);this.$axios.post("/app-menu",t).then((t=>{t=t.data,t&&t.Message&&this.$q.notify(t.Message)}))}))},delAppMenu(){this.$q.dialog({title:"确认删除菜单？",cancel:!0}).onOk((()=>{const t={Appids:[]};for(const e of this.selectedApps)t.Appids.push(e.Appid);this.$axios.delete("/app-menu",{params:t}).then((t=>{t=t.data,t&&t.Message&&this.$q.notify(t.Message)}))}))}}}),c=s,l=(n("1146"),n("2877")),o=n("9989"),u=n("ddd8"),p=n("9c40"),r=n("f09f"),d=n("a370"),v=n("0016"),b=n("42a1"),h=n("27f9"),m=n("e7a9"),f=n("4e73"),B=n("66e5"),x=n("4074"),M=n("0170"),q=n("eb85"),g=n("9f0a"),k=n("adad"),_=n("823b"),I=n("0378"),y=n("4b7e"),$=n("eebe"),S=n.n($),A=Object(l["a"])(c,a,i,!1,null,"73a0e74f",null);e["default"]=A.exports;S()(A,"components",{QPage:o["a"],QSelect:u["a"],QBtn:p["a"],QCard:r["a"],QCardSection:d["a"],QIcon:v["a"],QPopupEdit:b["a"],QInput:h["a"],QBtnGroup:m["a"],QMenu:f["a"],QItem:B["a"],QItemSection:x["a"],QItemLabel:M["a"],QSeparator:q["a"],QOptionGroup:g["a"],QTabPanels:k["a"],QTabPanel:_["a"],QForm:I["a"],QCardActions:y["a"]})}}]);